commands:
  01mvNginxConf:
    command: mv /etc/nginx/sites-available/elasticbeanstalk-nginx-docker-proxy.conf /etc/nginx/sites-available/elasticbeanstalk-nginx-docker-proxy.conf.orig

files:
  "/var/app/myfile1" :
    mode: "000755"
    owner: root
    group: root
    source: https://s3-us-west-2.amazonaws.com/siby-circletest-s3/docker/dockercfg
 
  "/root/myfile2" :
    mode: "000755"
    owner: root
    group: root
    content: |
      this is my file
      with content
  
  "/etc/nginx/sites-available/elasticbeanstalk-nginx-docker-proxy.conf" :
    mode: "000755"
    owner: root
    group: root
    content: |
      map $http_upgrade $connection_upgrade {
        default         "upgrade";
        ""                      "";
      }
      
      server {
        listen 80;
        listen 8443 ssl;
        server_name localhost;
        
        ssl_certificate /etc/nginx/ssl-cert/nginx.crt;
        ssl_certificate_key /etc/nginx/ssl-cert/nginx.key;
        ssl_verify_client optional;
        ssl_client_certificate /etc/nginx/ssl-cert/nginx1.crt;
        
        set $OK 0;
        if ( $uri ~ ^(/1/user/credentials) ) {
                set $OK "${OK}1";
        }
        if ( $ssl_client_verify != SUCCESS ) {
                set $OK "${OK}2";
        }
        
        if ( $OK = 012 ) {
                return 403;
        }
        
        location / {
                proxy_pass                      http://docker;
                proxy_http_version      1.1;
        
                proxy_set_header        Connection                      $connection_upgrade;
                proxy_set_header        Upgrade                         $http_upgrade;
                proxy_set_header        Host                            $host;
                proxy_set_header        X-Real-IP                       $remote_addr;
                proxy_set_header        X-Forwarded-For         $proxy_add_x_forwarded_for;
        }
      }
  
  "/etc/nginx/conf.d/proxy.conf" :
    mode: "000755"
    owner: root
    group: root
    content: |
      touch siby proxy.conf
